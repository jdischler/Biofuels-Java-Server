/*
 * File: app/view/RoundStageBar.js
 */
//------------------------------------------------------------------------------
Ext.define("Biofuels.view.RoundStageBar",{constructor:function(e){this.markers=new Array},addToSurface:function(e,t,n,r){this.surface=e,this.placement={x:t,y:n,width:r};var i=[{type:"rect",fill:"#000",opacity:"0.5",x:t,y:n-1,width:r,height:3,zIndex:100},{type:"rect",fill:"#fff",opacity:"0.25",x:t,y:n+1,width:r,height:1,zIndex:100}],s,o=e.add(i);this.timeline=o;for(s=0;s<o.length;s++)o[s].show(!0);this.year=1,this.yearLabel=e.add([{type:"text",text:" ",fill:"#000",font:"16px monospace",x:t,y:n-18},{type:"text",text:" ",fill:"#fff",font:"16px monospace",x:t,y:n-20}]),this.setYear(this.year),this.createStageMarker(e)},createStageMarker:function(e){this.stageMarker=e.add([{type:"circle",radius:12,fill:"#fa2",x:this.placement.x,y:this.placement.y+2,zIndex:1e3}]),this.stageMarker[0].show(!0),this.stage=0},setMarkers:function(e){var t;for(t=0;t<this.markers.length;t++)this.markers[t].detach(),this.markers[t].destroy();this.markers=[];var n=e.length-1;for(t=0;t<=n;t++){var r=Ext.create("Biofuels.view.RoundStageMarker"),i=this.placement.x+this.placement.width*(t/n);r.addToSurface(this.surface,i,this.placement.y,e[t]),this.markers.push(r)}},setYear:function(e){for(var t=0;t<this.yearLabel.length;t++){console.log("iteratin!");var n=this.yearLabel[t];n.show(!0),n.setText("Year "+e),n.setAttributes({x:this.placement.x+(this.placement.width-n.getBBox().width)*.5},!0)}},setStage:function(e,t){e<=this.stage?this.stageMarker[0].setAttributes({x:e*this.placement.width+this.placement.x},!0):this.stageMarker[0].animate({duration:t,to:{translate:{x:e*this.placement.width,y:0}}}),this.stage=e}});
/*
 * File: app/view/Field.js
 *
 * Visual representation of a field
 */
//------------------------------------------------------------------------------
Ext.define("Biofuels.view.Field",{requires:["Biofuels.view.CornPlantSprite","Biofuels.view.CoverCropPlantSprite","Biofuels.view.GrassPlantSprite","Biofuels.view.ToggleSprite"],constructor:function(e){this.crop=new Array,this.cropType="none"},attachTo:function(e,t,n){var r=[{type:"rect",width:160,height:120,radius:10,x:t,y:n,fill:"#864",stroke:"#364","stroke-width":10},{type:"image",src:"resources/field_overlay.png",x:t,y:n,width:160,height:120}];this.surface=e,this.atX=t,this.atY=n;var i=e.add(r);this.sprites=i;for(var s=0;s<i.length;s++)i[s].show(!0);this.addPlantingIcon(e,t+5,n+105),this.addManagementIcons(e,t+55,n+105)},addManagementIcons:function(e,t,n){this.fertilizer=Ext.create("Biofuels.view.ToggleSprite"),this.fertilizer.addToSurface(e,[{type:"image",src:"resources/fertilizer_no_icon.png",x:t,y:n,opacity:1,width:30,height:30,zIndex:1e3}],"resources/fertilizer_no_icon.png","resources/fertilizer_yes_icon.png"),this.till=Ext.create("Biofuels.view.ToggleSprite"),this.till.addToSurface(e,[{type:"image",src:"resources/till_no_icon.png",x:t+35,y:n,opacity:1,width:30,height:30,zIndex:1e3}],"resources/till_no_icon.png","resources/till_yes_icon.png"),this.pesticide=Ext.create("Biofuels.view.ToggleSprite"),this.pesticide.addToSurface(e,[{type:"image",src:"resources/pesticide_no_icon.png",x:t+70,y:n,opacity:1,width:30,height:30,zIndex:1e3}],"resources/pesticide_no_icon.png","resources/pesticide_yes_icon.png")},showManagementIcons:function(){this.fertilizer.show(),this.till.show(),this.pesticide.show()},hideManagementIcons:function(){this.fertilizer.hide(),this.till.hide(),this.pesticide.hide()},addPlantingIcon:function(e,t,n){var r=[{type:"image",src:"resources/planting_icon.png",x:t,y:n,opacity:1,width:30,height:30,zIndex:1e3}],i=e.add(r);this.plantingIcon=i[0],this.plantingIcon.show(!0),this.setPlantingIconListeners(),this.popup=Ext.create("Biofuels.view.PlantPopup"),this.popup.createForSurface(this.surface,t,n)},setPlantingIconListeners:function(){this.plantingIcon.on({mouseover:this.onMouseOver,mouseout:this.onMouseOut,scope:this.plantingIcon}),this.plantingIcon.on({click:this.onClick,scope:this})},showPlantingIcon:function(){this.plantingIcon.stopAnimation().show(!0).animate({duration:100,to:{opacity:1}}),this.setPlantingIconListeners()},hidePlantingIcon:function(){this.plantingIcon.stopAnimation().animate({duration:100,to:{opacity:0},callback:this.doHide,scope:this.plantingIcon}),this.plantingIcon.clearListeners()},doHide:function(){this.hide(!0)},onMouseOver:function(e,t){this.stopAnimation().animate({duration:100,to:{scale:{x:1.5,y:1.5},opacity:1}})},onMouseOut:function(e,t){this.stopAnimation().animate({duration:100,to:{scale:{x:1,y:1},opacity:1}})},onPlantingClickHandler:function(e){if(!e.localeCompare("cancel"))return;this.cropType!=e&&(this.removeOldCrop(),e.localeCompare("corn")?e.localeCompare("grass")?e.localeCompare("cover")||this.plantCoverCrop(this.surface):this.plantGrass(this.surface):this.plantCorn(this.surface),this.cropType=e)},onClick:function(e,t){this.popup.showPopup(this.onPlantingClickHandler,this)},removeOldCrop:function(){for(var e=0;e<this.crop.length;e++)this.crop[e].removeFromSurface()},showCrop:function(){for(var e=0;e<this.crop.length;e++)this.crop[e].sprite.show(!0)},hideCrop:function(){for(var e=0;e<this.crop.length;e++)this.crop[e].sprite.hide(!0)},plantCorn:function(e){var t=0,n=0;for(var r=0;r<16;r++){var i=t+this.atX+12,s=n+this.atY-22,o=Ext.create("Biofuels.view.CornPlantSprite");o.addToSurface(e,i,s,1e3+Math.random()*500),t+=35,t>=120&&(t=0,n+=30),this.crop.push(o)}},plantGrass:function(e){var t=0,n=0;for(var r=0;r<14;r++){var i=t+this.atX+12,s=n+this.atY-22,o=Ext.create("Biofuels.view.GrassPlantSprite");o.addToSurface(e,i,s,1200+Math.random()*800),t+=35,t>105&&(t-=140,t+=17.5,n+=30),this.crop.push(o)}},plantCoverCrop:function(e){var t=0,n=0;for(var r=0;r<14;r++){var i=t+this.atX+12,s=n+this.atY-22,o=Ext.create("Biofuels.view.CoverCropPlantSprite");o.addToSurface(e,i,s,1200+Math.random()*800),t+=35,t>105&&(t-=140,t+=17.5,n+=30),this.crop.push(o)}}});
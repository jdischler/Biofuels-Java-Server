/*
 * File: NetworkLayer.js
 */
// TODO: would be nice if this could be shared between: player, moderator, global projects?
Ext.define("BiofuelsModerator.view.NetworkLayer",{constructor:function(){this.networkEvents=new Array},registerListener:function(e,t,n){console.log("reg listener");var r={name:e,processor:t,scope:n};this.networkEvents.push(r)},openSocket:function(e,t,n){WsConnection.websocket=new WebSocketRails("localhost:3000/websocket");var r=this;WsConnection.webSocket.on_open=function(){console.log("the sockets are open")},WsConnection.webSocket.on_close=function(){console.log("WsConnection.websocket onClose!!")},WsConnection.webSocket.on_message=function(e){},WsConnection.webSocket.on_error=function(){console.log("websocket onError!!")};var i=function(e){console.log("assigned id "+e),WsConnection.webSocket.id=e.toString();var t=WsConnection.websocket.subscribe(e.toString());t.bind("event",function(e){var t=JSON.parse(e),n;for(n=0;n<r.networkEvents.length;n++){var i=r.networkEvents[n];t.event.localeCompare(i.name)||i.processor.call(i.scope,t)}})};WsConnection.webSocket.trigger("get_new_id","blank",i)},send:function(e){var t=new Array;t.push(WsConnection.webSocket.id),t.push(e),WsConnection.webSocket.trigger("receive_event",t)}});